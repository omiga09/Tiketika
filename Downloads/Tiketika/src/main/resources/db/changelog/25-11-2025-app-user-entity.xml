<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
           http://www.liquibase.org/xml/ns/dbchangelog
           http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.17.xsd">

               <changeSet id="10" author="omar">
                   <createTable tableName="app_user_entity">
                       <column name="id" type="BIGINT" autoIncrement="true">
                           <constraints primaryKey="true" nullable="false"/>
                       </column>
                       <column name="entity_type" type="VARCHAR(50)"/>
                       <column name="user_id" type="BIGINT"/>
                       <column name="owner_id" type="BIGINT"/>

                       <!-- BaseAuditable fields -->
                       <column name="created_at" type="TIMESTAMP"/>
                       <column name="updated_at" type="TIMESTAMP"/>
                       <column name="submitted_at" type="TIMESTAMP"/>
                       <column name="created_by" type="VARCHAR(255)"/>
                       <column name="updated_by" type="VARCHAR(255)"/>

                   </createTable>

                   <createIndex indexName="idx_user_entity_id"
                                tableName="app_user_entity">
                       <column name="id"/>
                   </createIndex>

                   <createIndex indexName="idx_user_entity_type"
                                tableName="app_user_entity">
                       <column name="entity_type"/>
                   </createIndex>

                   <createIndex indexName="idx_user_entity_owner"
                                tableName="app_user_entity">
                       <column name="owner_id"/>
                   </createIndex>

                   <addForeignKeyConstraint baseTableName="app_user_entity"
                                            baseColumnNames="user_id"
                                            referencedTableName="app_user"
                                            referencedColumnNames="id"
                                            constraintName="fk_userentity_user"/>

                   <addForeignKeyConstraint baseTableName="app_user_entity"
                                            baseColumnNames="owner_id"
                                            referencedTableName="app_entity_owner"
                                            referencedColumnNames="id"
                                            constraintName="fk_userentity_owner"/>
               </changeSet>
</databaseChangeLog>